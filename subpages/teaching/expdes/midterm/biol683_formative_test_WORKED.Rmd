---
title: "BIOL 683 — Formative Assessment 1 (Worked Example)"
author: "Example Solution"
date: "`r format(Sys.Date())`"
output:
  pdf_document:
    toc: true
    number_sections: false
  html_document:
    toc: true
    toc_float: true
    number_sections: false
    theme: readable
fontsize: 11pt
geometry: margin=1in
---

> **What this file is:** A fully worked example that **does all tasks** from the assignment: simulates data, runs diagnostics, chooses/tests models, reports effect sizes and CIs, produces accessible figures, and includes a brief AI‑use reflection. Knit to **PDF** (or HTML).

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 6.5, fig.height = 4.5)
set.seed(8675309)
```

## Section A — Simulate Data, Describe, and Explore

We simulate two groups (n = 30 each) of a biological measurement:
- **Group A:** Normal(10, 2) — approximately symmetric around 10.
- **Group B:** Log‑normal(meanlog = 2.3, sdlog = 0.3) — positively skewed, strictly > 0.

```{r A-sim}
n <- 30
grpA <- rnorm(n, mean = 10, sd = 2)
grpB <- rlnorm(n, meanlog = 2.3, sdlog = 0.3)

group <- factor(rep(c("A","B"), each = n))
y <- c(grpA, grpB)

df <- data.frame(group, y, row = seq_len(2*n))
head(df, 6)
```

**Data description (example):** Suppose **A** is a control line’s enzyme activity (roughly symmetric) and **B** is a treatment that induces heterogeneous responses, producing a **right‑skewed** distribution (some high responders). We expect the mean of **B** to exceed **A**, but normality may be violated for **B** due to skew.

### Summary table

```{r A-summary}
summ <- aggregate(y ~ group, df, function(v) c(n = length(v), mean = mean(v), sd = sd(v)))
summ <- data.frame(group = summ$group, n = summ$y[,"n"], mean = summ$y[,"mean"], sd = summ$y[,"sd"])
summ
```

### Exploratory plots

```{r A-plots, fig.height=4.2}
op <- par(mfrow = c(1,2), mar = c(4,4,1,1))
hist(grpA, breaks = "FD", main = "Group A — Histogram", xlab = "Value", col = "gray85", border = "white")
hist(grpB, breaks = "FD", main = "Group B — Histogram", xlab = "Value", col = "gray85", border = "white")
par(op)
```

```{r A-box, fig.height=4.2}
# Choose an accessible palette; fallback if viridisLite is unavailable
cols <- if (requireNamespace("viridisLite", quietly = TRUE)) viridisLite::viridis(2) else c("#2C7BB6", "#D7191C")
boxplot(y ~ group, data = df, main = "Group comparison (boxplot + points)", ylab = "Value", col = adjustcolor(cols, 0.25), border = "gray30")
stripchart(y ~ group, data = df, vertical = TRUE, method = "jitter", pch = 16,
           col = adjustcolor(cols[df$group], 0.8), add = TRUE)
```

---

## Section B — Assumptions & Diagnostics

We check normality (QQ‑plots and Shapiro–Wilk). With small \(n\), Shapiro–Wilk has **low power**; with large \(n\), it can flag trivial deviations. We combine visual diagnostics + biological reasoning.

```{r B-qq, fig.height=4.2}
op <- par(mfrow = c(1,2), mar = c(4,4,1,1))
qqnorm(grpA, main = "QQ — Group A"); qqline(grpA, col = "gray40")
qqnorm(grpB, main = "QQ — Group B"); qqline(grpB, col = "gray40")
par(op)
```

```{r B-shapiro}
shapiro_A <- shapiro.test(grpA)
shapiro_B <- shapiro.test(grpB)
shapiro_A
shapiro_B
```

Given **B** is strictly positive and visibly skewed, a **log transform** is reasonable. We apply \(\log(y)\) where valid.

```{r B-transform}
df$y_log <- ifelse(df$y > 0, log(df$y), NA_real_)
# Quick check after transform
by(df$y_log, df$group, function(v) c(n = sum(!is.na(v)), mean = mean(v, na.rm=TRUE), sd = sd(v, na.rm=TRUE)))
```

---

## Section C — Statistical Testing & Estimation

### 1) Welch two‑sample t‑tests (raw and transformed)

```{r C-welch}
welch_raw <- t.test(y ~ group, data = df)                    # default Welch
welch_log <- t.test(y_log ~ group, data = df, na.action = na.omit)
welch_raw
welch_log
```

### 2) Mann–Whitney (Wilcoxon rank‑sum)

```{r C-wilcox}
mw <- wilcox.test(y ~ group, data = df, exact = FALSE)
mw
```

### 3) Effect size (Hedges’ g) and 95% CIs for group means

```{r C-effects}
hedges_g <- function(x, y){
  nx <- length(x); ny <- length(y)
  sx2 <- var(x); sy2 <- var(y)
  sp <- sqrt(((nx-1)*sx2 + (ny-1)*sy2)/(nx+ny-2))
  g <- (mean(x) - mean(y))/sp
  J <- 1 - 3/(4*(nx+ny)-9)  # small-sample correction
  g * J
}
g_raw <- with(df, hedges_g(y[group=="A"], y[group=="B"]))
g_log <- with(df, hedges_g(y_log[group=="A"], y_log[group=="B"]))
g_raw; g_log

# Means and 95% CI (mean ± 1.96*SE) for illustration
agg <- aggregate(y ~ group, df, function(v) c(mean=mean(v), se=sd(v)/sqrt(length(v))))
agg <- data.frame(group = agg$group, mean = agg$y[, "mean"], se = agg$y[, "se"])
agg$lower <- agg$mean - 1.96*agg$se
agg$upper <- agg$mean + 1.96*agg$se
agg
```

### 4) CI plot and a data‑showing figure

```{r C-ci-plot, fig.height=4}
plot(agg$group, agg$mean, ylim = range(c(agg$lower, agg$upper)), xlab = "Group", ylab = "Mean with 95% CI",
     pch = 19, main = "Group means ± 95% CI", col = cols)
arrows(x0 = 1:2, y0 = agg$lower, x1 = 1:2, y1 = agg$upper, angle = 90, code = 3, length = 0.05)
```

```{r C-show-data, fig.height=4.2}
stripchart(y ~ group, data = df, vertical = TRUE, pch = 16, method = "jitter",
           col = adjustcolor(cols[df$group], 0.8), main = "Data shown (jitter) + Boxplot", ylab = "Value")
boxplot(y ~ group, data = df, add = TRUE, border = "gray30", col = NA)
```

### 5) Interpretation (example)

**Summary (example):** Welch’s t on raw data indicates a significant mean difference (skew drives higher mean in **B**). The log transform reduces skew and still supports a difference, aligning with the Mann–Whitney test. Effect sizes (Hedges’ g) are **moderate to large**, suggesting biologically meaningful differences. CIs around group means do not overlap strongly, supporting the inference while visualizations confirm skew in **B**.

---

## Section D — Figure Design & Accessibility

The figures above: (i) **show the data** (jittered points + boxplot), (ii) avoid chartjunk, (iii) use an **accessible** palette (viridis fallback provided), and (iv) have informative labels. The CI plot communicates uncertainty; the jitter+boxplot shows distributional shape and potential outliers.

---

## Section E — AI Use & Reflection (example)

- **Prompts used (illustrative):**
  - “Write base R code to compare two groups with Welch’s t‑test and Mann–Whitney, and compute Hedges’ g.”
  - “Create a publication‑quality figure that shows the data for two groups using a color‑blind‑safe palette.”
- **Where AI helped:** Speeding up scaffolding code and reminding me of effect‑size formulas.
- **Where AI erred / needed correction:** Initial code suggested installing packages mid‑knit; I replaced it with a palette fallback to avoid knit failures. Also adjusted CI computation to be transparent (mean ± 1.96·SE) and stated its limitations.

---

## Reproducibility Appendix

```{r session-info}
sessionInfo()
```

