---
title: "HW4"
author: "Heath Blackmon"
date: "2/8/2018"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Bayes Theorem and Probability

Suppose you are studying a pair of cryptic species. In your area 5% of individuals are species A and 95% of individuals are species B. There is currently no genetic assay capable of telling them apart. They differ however in the frequency of a rare color pattern. Species A has the rare color pattern 50% of the time while species B has the rare color pattern only 2% of the time.  Assume these numbers are known with certainty, from many years of field research. 

```{r}
# probabilities in the field
p_a <- .05
p_b <- .95

# conditional probabilities for color give species
p_rc_a <- .5
p_rc_b <- .02
```

### Problem 1
Now suppose you find one of these species with the rare color pattern. Use Bayes theorem to compute the probability that it is from species A.

So here is our basic equation for this problem:
$$p(species A | rare color) = \frac{p(rare color | species A) \times p(species A)}{p(rare color)}$$

```{r}
p_a_rc <- (p_rc_a * p_a) / (p_rc_a * p_a + p_rc_b * p_b)
p_a_rc
```

So we have a 56.8% chance that this specimen belongs to species A.

### Problem 2
A new paper comes out that states that species B has a morphological feature 50% time that is only present 10% of the time in species A.  Your sample has this feature.  What is the probability that you have a sample of species A now? 

```{r}
# our updated prior on the probability that our individual is species a
up_a <- p_a_rc
# probability of marker if species a
p_m_a <- .1
# probability of marker if species b
p_m_b <- .5

p_a_m <- (p_m_a * up_a) / (p_m_a * up_a + p_m_b * (1-up_a))
p_a_m
```

So with this new information we now think there is only an 11.8% chance that our sample belongs to species A.

### Problem 3
Suppose now that a genetic test is developed that can identify the species of our sample. But the test, like all tests, is imperfect. This is the information you have about the test:

a.	The probability it correctly identifies species A is 0.95

b.	The probability it correctly identifies species B is 0.98

You run the test and it is positive for species A. Compute the posterior probability that your sample is species A using all the information available.

```{r}
# our updated prior on the probability that our individual is species a
up_a <- p_a_m
# probability that positive for species a if species a
p_pta_a <- .7
# probability that positive for species a if species b
p_pta_b <- .02

p_a_pta <- (p_pta_a * up_a) / (p_pta_a * up_a + p_pta_b * (1-up_a))
p_a_pta
```

## MCMC

For this question download the file mcmc.log.csv from the website. Typical software that uses a Bayesian approach produces log files that document the parameter values sampled during the MCMC (Markov chain Monte Carlo) run.  You have just completed running MrBayes to reconstruct the gene tree for a collection of odorant receptor genes in your species of interest.  

### Problem 4
You know that 3rd codon positions should evolve more quickly than 1st or 2nd codons.  You can use this knowledge to make sure that you set up the analysis correctly. Use your R skills to plot a comparison of the rate of evolution for all 3 codons.
```{r}
log <- read.csv("data/mcmc.log.csv")
plot(density(log$codon1),ylim=c(0,2),xlim=c(0,14), col="red",main="rates of evolution")
lines(density(log$codon2),col="blue")
lines(density(log$codon3))
text(x=mean(log$codon1), y=1.9, "codon 1", cex=.7)
text(x=mean(log$codon2), y=1.9, "codon 2", cex=.7)
text(x=mean(log$codon3), y=1.9, "codon 3", cex=.7)


```

### Problem 5
5)	In Bayesian stats, we compare highest posterior densities rather than confidence intervals.  Highest posterior densities are the narrowest part of a distribution that contains 95% of our sample.  Install the package coda. Calculate and report the 95% highest posterior density for the rate of evolution for each codon position.  Do you believe that the rate of evolution for the three codons is different?

```{r}
library(coda)
HPDinterval(as.mcmc(log$codon1))
HPDinterval(as.mcmc(log$codon2))
HPDinterval(as.mcmc(log$codon3))
```

