---
title: "Study of comparative methods -- parametric bootstrapping"
author: "Heath Blackmon"
date: "September 15, 2015"
output: 
  html_document:
    theme: cosmo
    toc: true
    toc_depth: 2
---

[Return to main website](http://coleoguy.github.io/resources.html)

Return to of comparative methods page [1](http://coleoguy.github.io/comparative.html) [2](http://coleoguy.github.io/comparative_2.html) [3](http://coleoguy.github.io/comparative_3.html)

___
#simulated data - trees
```{r}
### Generate trees
set.phy <- list()
seed.counter <- 1
for(i in 1:100){
  tree.good <- F
  # this conditions on the tree haveing 101-199 tips
  while(tree.good == F){
    set.seed(seed.counter)
    phy <- diversitree::tree.bd(pars = c(1, 0.1), max.t=6)
    if(length(phy$tip.label) > 100 & length(phy$tip.label) < 200){
      set.phy[[i]] <- phy
      tree.good <- T
    }
    seed.counter <- seed.counter + 1
  }
}
```

___
#simulated data - states - Darwin's scenario
```{r}
### Generate trees and traits that mimics "Darwin's scenario"
set.state <- list()
used.nodes <- vector()
for(i in 1:100){
  data.good <- F
  # this conditions on the node where our trait changes having
  # between 40 and 60% of the species on the tree
  node.counter <- length(set.phy[[i]]$tip.label) + 1
  while(data.good == F){
    node.counter <- node.counter + 1
    descendents <- phangorn::Descendants(set.phy[[i]], 
                                         node=node.counter, 
                                         type="tips")[[1]]
    max.tip <- length(set.phy[[i]]$tip.label) * .70
    min.tip <- length(set.phy[[i]]$tip.label) * .30
    if(length(descendents) < max.tip & length(descendents) > min.tip){
      states <- vector(mode="numeric", length=length(set.phy[[i]]$tip.label))
      states[descendents] <- 1
      set.state[[i]] <- states
      used.nodes[i] <- node.counter
      data.good <- T
    }
  }
}
state.darwin <- set.state
```


___
#simulated data - dependent evolution

Lets plot 3 of our datasets and make sure that they look the way that we are expecting them to:

```{r}
par(mfcol=c(1,3))
for(i in 1:3){
  pick <- sample(1:100, size=1)
  plot(set.phy[[pick]], show.tip.label = F)
  tip.cols <- c("red", "blue")
  ape::tiplabels(pch = 20, col = tip.cols[set.state[[pick]] + 1])
}
```

That looks great just like we want it to!

#the Pagel test in R
We will use diversitree to fit our models of trait evolution in diversitree. To do this we will need two models an independent and dependent.
iQ<-matrix(c(0,1,2,0,3,0,0,2,4,0,0,1,0,4,3,0),4,4,byrow=TRUE)
	rownames(iQ)<-colnames(iQ)<-levels(xy)
	fit.iQ<-if(method=="fitDiscrete") fitDiscrete(tree,xy,model=iQ) else ace(xy,tree,type="discrete",model=iQ)
	## fit dependendent model
	dQ<-matrix(c(0,1,2,0,3,0,0,4,5,0,0,6,0,7,8,0),4,4,byrow=TRUE)


So first lets try it out on 
x<- y <- set.state[[1]]
phy <- set.phy[[1]]
names(x) <- names(y) <- phy$tip.label
fit.ape<-fitPagel(tree=phy,x=x, y=y, method="fitDiscrete")
fit.ape








___
#Boettiger's approach

Carl Boettiger published a paper in Evolution in early 2012 titled ["Is your phylogeny informative? Measuring the power of comparative methods."](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3448289/)[1]  In this paper the authors argue that a Monte Carlo-based approach can be used to appropriately evaluate the uncertainty present in our comparative analyses. The manuscript focuses on continuous trait evolution and uses a data set consisting of a tree and body size data for 23 species of _Anolis sp._. They then show the application of their approach in comparing various models for body size evolution.

My interest in this approach is to determine whether it would alleviate the problems that were highlighted in Maddison and Fitzjohn's recent paper [2].  I would argue that it should since I believe that the central issue driving the result in Maddison and Fitzjohn is a lack of penalty for the uncertainty in our estimates.  Below I'll attempt to show this.






[Return to main website](http://coleoguy.github.io/resources.html)

[Return to page 1 of comparative methods](http://coleoguy.github.io/comparative.html)

___
#citations

[1] Boettiger, Carl, Graham Coop, and Peter Ralph. "Is your phylogeny informative? Measuring the power of comparative methods." Evolution 66, no. 7 (2012): 2240-2251.

[2] Maddison, Wayne P., and Richard G. FitzJohn. "The unsolved challenge to phylogenetic correlation tests for categorical characters." Systematic biology 64, no. 1 (2015): 127-136.