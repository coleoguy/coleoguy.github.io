---
title: "Plotting with ggplot2"
author: "Terrence Sylvester"
date: "3/8/2019"
output: html_document
---

#### Notes 

__For this tutorial you will need to install and load the package `ggplot2`. You can do that by typing following command in your console__

`install.packages(ggplot2)`

```{r}

# load required libraries
library(ggplot2)
```

__we will be using the iris that is already available in base R and the data-sets that comes with `ggplot2`__

## What is `ggplot2`?

`ggplot2` is a R package used for data visualization which was developed by Hadley Wickham in 2005. Unlike other data visualization packages, `ggplot2` is based on Grammar of Graphics.

As you use different words and arrange them in meaningful sentences, grammar of graphics allows you to use different elements in data and arrange them so that you can express your data in a meaningful way. 

Lets look at an example

```{r, echo=F}

ggplot(data = iris, aes(x = Sepal.Length,
                           y = Sepal.Width)) + 
  geom_point()+
  geom_smooth(method = "lm")

```

In this plot we have several elements;

* Data: `iris` data-set
* Points showing the relationship of x `(Sepal.Length)` and y `(Sepal.Width)`
* Statistical transformation: the linear relationship between x and y
* Te scales used for plotting: in this case it is a linear scale
* The coordinate system: Cartesian

Each of these elements act as a word in a sentence. In `ggplot2` these elements are implemented as layers.

# Using `ggplot2`

## Data

`ggplot2` uses data in the form of a data frame. Following is an example of the input data for `ggplot2`.

```{r, echo=FALSE}
head(iris)

```

If your data is in the format of a matrix, make you convert your data matrix into a data frame. A data frame is a two dimensional table with the variables given in the columns and the observations given in rows.

## Plotting with `ggplot2`

### Aesthetics

When plotting with `ggplot2` the first argument you use is `ggplot()`. This sets the coordinate system in which you add layers of layers of data.

After `ggplot()` function you start adding the layers.

Lets see an example

```{r}
ggplot()
```

In the above code you created the coordinate system. As you can see it is empty right now. Lets start adding data to this coordinate system.

For this example I will be using `mpg` data-set that comes with `ggplot2`. The `mpg` data-set looks like following

```{r, echo=FALSE}
head(mpg)
```

In your console if you type `help(mpg)` or `?mpg` you can see further information about this data-set.

Lets plot

```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point()
```

Here I have plotted the engine displacement `(displ)` in x-axis and highway miles per gallon `(hwy)` in y-axis. So we added a layer to our coordinate system which shows the relationship between `displ` and `hwy`.

Here you may have noted that in our `ggplot()` function, I have added something called `aes`.This function refers to aesthetics or aesthetic mappings. An aesthetic is something you can see in your plot. Some examples of the aesthetics are:

  * colour of the points
  * size / shape of the points
  * position of your points in x an y axis

Once you specify your data and aesthetics you can start adding layers. Each layer should be preceded by a `+` sign. In the given example I have one layer. You can specify your aesthetics when you make your coordinate system or else you can specify your aesthetics in each layer.

Here I have used the colour aesthetic in order to group them by the type of car.

```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(colour = class))
```

lets look at several other aesthetics

__Size__
```{r, warning=FALSE}
# size aesthetic
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(size = class))
```

__Alpha (transparency)__
```{r, warning=FALSE}
# transperancy of the points aesthetic
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(alpha = class))
```

__Shape__
```{r, warning=FALSE}
# shape aesthetic
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(shape = class))
```

Here you don't see a shape for class SUV. That is because `ggplot2` can only use six shapes at a time.

#### Exercise 1
1. Using `iris` data-set make a plot which shows the relationship between `Petal.Length` and `Petal.Width`. 

  * Colour your data points according to the species.

  * Use shapes to denote different species

2. Change axis labels of your plot by using the following layers
  + `xlab()` and `ylab()`.

3. find what is wrong with the following code and correct it. (hint: why are the point colours are not blue)

```{r}
ggplot(data = iris) + 
  geom_point(aes(x = Sepal.Length, y = Sepal.Width, colour = "blue"))
```


### Geometric objects (`geom`)

In the above example you may have noted that the layers I have used starts with the term  "geom". These layers which start with "geom" are known as geometric objects. Geometric objects are the things that you put in your coordinate system. There are many geometric objects in `ggplot2`. Few examples are:

  * points
  * histograms
  * lines
  * box plots

Lets see some geometric objects

__Two geometric layers together__
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth()

```

__Bar plot__
```{r}
ggplot(data = mpg) +
  geom_bar(aes(x = class, colour = class))
```

Colour aesthetic in bar charts will only colour the edge of the bar. A better way to colour the bar charts is to use fill aesthetic.

```{r}
ggplot(data = mpg) +
  geom_bar(aes(x = class, fill = class))
```

#### Exercise 2

1. Using the mpg data set

  * make a box plot that shows the relationship between the engine displacement `displ` and the vehicle class `class`. Colour your plot according to the vehicle class.

  * make a bar plot that shows the number of classes each manufacturer made.

2. Using the iris data set

  * make a plot which shows the relationship between `Petal.Length` and `Petal.Width`. Colour your data points according to the species.

  * Add a line that shows the linear relationship between two variables.
  
3 Using the iris data set make a plot that shoes the relationship between the `Petal.Width` and `Sepal.Length`. Add another layer that connects these points with lines.

### Facets
So far we used aesthetics to group variables. Another way to group them, especially for categorical variables is to break your plot in to smaller plots or `facets`.

```{r}
ggplot(data = mpg) +
  geom_point(aes(x = displ, y = hwy)) +
  facet_wrap(~class, nrow = 2)
```

if you want to use a single variable to group use `facet_wrap`. If you want to use two variables to group, use `facet_grid`.

```{r}
ggplot(data = mpg) +
  geom_point(aes(x = displ, y = hwy)) +
  facet_grid(drv~cyl)
```

notice that when you use either `facet_wrap` or `facet_grid` the variables you use to group are given in the form of a formula. for `facet_wrap` this is written as `~ variable`. For `facet_grid` it is `variable1 ~ variable2`.

#### Exercise 3
1. Using `iris` data set make a plot which shows the relationship between `Petal.Length` and `Petal.Width`. Use `facet_wrap` to group this plot according to species.

2. Using `diamonds` data set make a plot which shows the relationship between the `price` and the weight of the diamond (`carat`). Colour them by the diamond colour. use `facet_wrap` group them by the quality of the cut.

### Position Adjustment
__for this section we will use the `diamond` data set in `ggplot2`__

```{r, echo=FALSE}
head(diamonds)
```

Here I am plotting the quality of the cut of the diamonds using a bar graph. Furthermore, I am grouping them according to the clarity of the diamonds.

```{r}
ggplot(data = diamonds) +
  geom_bar(aes(cut, fill = clarity))
```

You can see that some bars are small but these bars have several groups which are not that clear to the viewer. We can use the position argument in the `geom_bar` to adjust the bar sizes.

For the position argument there are three options "identify" , "fill" and "dodge".

If you do not specify the position argument then `geom_bar` will automatically use "identity" as the default potion.

__fill__
This option will look at the proportion across groups. The bars will have the same height.

```{r}
ggplot(data = diamonds) +
  geom_bar(aes(cut, fill = clarity),
           position = "fill")
```

__dodge__
This option will put overlapping bars beside one another.

```{r}
ggplot(data = diamonds) +
  geom_bar(aes(cut, fill = clarity),
           position = "dodge")
```

__jitter__
This position argument is not used in bar graphs. Instead it is used in scatter plots. When there are overlapping points in a scatter plot, `jitter` will add small amount of nose to the points so that overlapping points are visible.

```{r}
ggplot(data = mpg) + 
  geom_point(aes(x = displ, y = hwy),
             position = "jitter")
```

#### Exercise 4
1. Using the mpg data set
  * make a box plot that shows the relationship between the engine displacement `displ` and the vehicle class `class`. Colour your plot according to the vehicle class.

  * make a bar plot that shows the number of classes each manufacturer made.

Try different options in the position argument

